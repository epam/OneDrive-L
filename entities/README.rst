========
Entities
========

Introduction
============
This sub-project defines entities common for the whole project such as
``LocalItem`` or ``Drive``.

The entities schemas are defined in IDL - `Protocol Buffers`_ - and then
language-specific DTO definitions are automatically generated for a
target-language.

Generation of language-specific code is done using
`Protocol Buffer Compiler (or Protoc) plugins`__.

__ `Protoc plugins`_

.. _Protocol Buffers: https://developers.google.com/protocol-buffers/
.. _Protoc plugins: https://developers.google.com/protocol-buffers/docs/reference/other#plugins

Glossary
--------
`Protocol Buffers, Protobuf`__
    Popular IDL_ developed by Google.

__ `Protocol Buffers`_

DTO
    `Data Transfer Object`_.

.. _Data Transfer Object: https://en.wikipedia.org/wiki/Data_transfer_object

IDL_
    `Interface Definition Language`__.

.. _IDL: https://en.wikipedia.org/wiki/IDL_(programming_language)

__ IDL_

How to's
========

How to generate definitions?
----------------------------
Refer to ``Makefile`` in the project's root - it defines all the necessary
tasks.

How to change Entity structure?
-------------------------------
1. Locate the corresponding .proto file.
2. Make changes referring to the official
   `Protocol Buffers Language version 3`_ guide.
3. Re-generate corresponding DTO definitions using the corresponding
   Protocol Buffers compiler plugin.
4. Commit newly generated files to VCS.

.. _Protocol Buffers Language version 3: https://developers.google.com/protocol-buffers/docs/proto3

TODO
====
- Validation: it is not implemented because it's not so obvious how to do
  that.
  The first that comes to mind that should be validated is whether a
  "required" field is set or not. But it does makes sense only for a
  self-describing format, like JSON. For non-self describing format that uses
  pre-defined schemas like Protobuf it doesn't really make sense because
  message structure is already enforced by the parser and so what is left
  is validation of the field's content but not it's presence/absence and
  it doesn't matter whether it is 0 or "something else" since "something else"
  could also be erroneous (e.g. generated by a buggy client).
  When it makes sense to validate "required" fields is when message structure
  allows some fields to be absent (optional). But it is not clear at this
  moment how to implement usable and generic validation for such cases.
